sudo: false
language: java
jdk:
  - openjdk8
cache:
  directories:
    - $HOME/.m2
before_cache:
  # No sense in caching current build artifacts
  - rm -rf $HOME/.m2/repository/com/github/vlsi/mat
  # This file is generated by maven-obr-plugin
  - rm -rf $HOME/.m2/repository/repository.xml
env:
  global:
    - DISPLAY=:99.0
install:
  - (cd MatCalciteDependencies && mvn install)
script:
  - |
    if [ -n "$TRAVIS_TAG" ]; then
      # Deploy a release version
      mvn --settings settings.xml -Dbintray.repository=eclipse -Prelease-mat-calcite clean verify
    elif [ "$TRAVIS_BRANCH" = "master" ]; then
      # Deploy dev version
      mvn --settings settings.xml -Dbintray.repository=eclipse-test -Prelease-mat-calcite clean verify
    else
      # check pull request
      mvn clean verify
    fi

deploy:
  provider: releases
  api_key:
    secure: WJGtlMnyktPazmcaBUM+ZlUAIJOJgqB/xVcDCEtuiFQb76mwyZsYxXw8seKlPcoJUmzo0QQPZxY0hPJTVe89EqwzXJz2tHap0PRITe/Hx9IexTWXP2BbqUlF6ewYmHzpEJ11P2eBRM4agBAh5y6w+S0O9GT3Zaw15rqbd2fG2MU=
  file_glob: true
  file: "MatCalciteRepository/target/MatCalciteRepository-*.zip"
  skip_cleanup: true
  on:
    tags: true
    repo: vlsi/mat-calcite-plugin
